import{a as n}from"./app.05452035.js";import{_ as s}from"./plugin-vue_export-helper.21dcd24c.js";const a={},p=n(`<h1 id="\u524D\u7AEF\u4E8C\u8FDB\u5236-arraybuffer-blob-file-filereader-canvas-base64" tabindex="-1"><a class="header-anchor" href="#\u524D\u7AEF\u4E8C\u8FDB\u5236-arraybuffer-blob-file-filereader-canvas-base64" aria-hidden="true">#</a> \u524D\u7AEF\u4E8C\u8FDB\u5236\uFF08arrayBuffer/Blob/File/fileReader/canvas/base64\uFF09</h1><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8f4dfaf5a9bb43abbbb1a7ff7c47471c~tplv-k3u1fbpfcp-zoom-crop-mark:1304:1304:1304:734.awebp" alt="js\u4E00\u5F20\u56FE\u641E\u5B9AarrayBuffer/Blob/File/fileReader/canvas/base64\u7684\u5404\u79CD\u8F6C\u6362\u64CD\u4F5C,\u4EE5\u53CA\u6587\u4EF6\u4E0A\u4F20"></p><h1 id="\u4E8C\u8FDB\u5236" tabindex="-1"><a class="header-anchor" href="#\u4E8C\u8FDB\u5236" aria-hidden="true">#</a> \u4E8C\u8FDB\u5236</h1><ul><li>ArrayBuffer</li><li>TypedArray</li><li>DataView</li><li>\u5B57\u7B26&amp;&amp;base64 \u8F6C\u5316</li><li>FileReader &amp;&amp; Blob/File \u8F6C\u5316</li><li>File &amp;&amp; Blob \u8F6C\u6362</li><li>Bolb</li><li>DataURL(base64) &amp;&amp; OjectURL \u7528\u6CD5</li><li>canvas \u4E0A\u4F20\uFF0C\u7EFC\u5408\u5E94\u7528 <ul><li>imageData =&gt; canvas \u5E94\u7528</li><li>canvas =&gt; imageData \u5E94\u7528</li></ul></li><li>express \u56FE\u7247\u4E0A\u4F20\u670D\u52A1</li></ul><h2 id="\u56FE\u7247\u6D89\u53CA\u4E86\u6D41\u7684\u5404\u79CD\u8F6C\u5316-\u4E0B\u9762\u662F\u5404\u79CD\u4F8B\u5B50-\u53EF\u6839\u636E\u9700\u8981\u5230\u4E0B\u9762\u627E\u5BF9\u5E94\u7684\u4F8B\u5B50" tabindex="-1"><a class="header-anchor" href="#\u56FE\u7247\u6D89\u53CA\u4E86\u6D41\u7684\u5404\u79CD\u8F6C\u5316-\u4E0B\u9762\u662F\u5404\u79CD\u4F8B\u5B50-\u53EF\u6839\u636E\u9700\u8981\u5230\u4E0B\u9762\u627E\u5BF9\u5E94\u7684\u4F8B\u5B50" aria-hidden="true">#</a> \u56FE\u7247\u6D89\u53CA\u4E86\u6D41\u7684\u5404\u79CD\u8F6C\u5316 \u4E0B\u9762\u662F\u5404\u79CD\u4F8B\u5B50 \u53EF\u6839\u636E\u9700\u8981\u5230\u4E0B\u9762\u627E\u5BF9\u5E94\u7684\u4F8B\u5B50</h2><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/33e74b70c4d14aa2b6c3d6c4eb77be64~tplv-k3u1fbpfcp-watermark.awebp" alt="file.jpg"></p><h2 id="\u4E8C\u8FDB\u5236\u7684\u8F6C\u5316" tabindex="-1"><a class="header-anchor" href="#\u4E8C\u8FDB\u5236\u7684\u8F6C\u5316" aria-hidden="true">#</a> \u4E8C\u8FDB\u5236\u7684\u8F6C\u5316</h2><ul><li>\u6574\u6570\u90E8\u5206:\u96642\u53D6\u4F59,\u76F4\u5230\u5546\u4E3A0,\u6700\u5148\u5F97\u5230\u7684\u4F59\u6570\u662F\u6700\u4F4E\u4F4D,\u6700\u540E\u7684\u4F59\u6570\u662F\u9AD8\u4F4D</li><li>\u5C0F\u6570\u90E8\u5206:\u4E582\u53D6\u6574,\u76F4\u5230\u79EF\u4E3A0\u6216\u8005\u7CBE\u786E\u5EA6\u8981\u6C42\u4E3A\u6B62,\u6700\u5148\u5F97\u5230\u7684\u6574\u6570\u662F\u9AD8\u4F4D</li><li>(3.5)10 = (11.1)2</li><li>\u539F\u7801:\u4E8C\u8FDB\u5236\u6570,3\u4E2Abit\u80FD\u8868\u793A8\u4E2A\u6570 +0+1+2+3-0-1-2-3,4\u6B634\u8D1F(\u6700\u9AD8\u4F4D1\u5373\u4E3A\u8D1F\u6570,0\u4E3A\u6B63\u6570)</li><li>\u53CD\u7801:\u6B63\u6570\u4E0D\u53D8,\u8D1F\u6570\u7684\u9664\u7B26\u53F7\u5916\u5176\u4ED6\u4F4D\u6570\u53D6\u53CD</li><li>\u8865\u7801:\u6B63\u6570\u4E0D\u53D8,\u8D1F\u6570\u5728\u53CD\u7801\u7684\u57FA\u7840\u4E0A\u52A01(\u6700\u9AD8\u4F4D\u8981\u820D\u6389)</li><li>\u8BA1\u7B97\u673A \u53EA\u6709\u8865\u7801 \u4E00\u79CD,\u6B63\u6570+\u4ED6\u8D1F\u6570\u7684\u8865\u7801=0,\u8BA1\u7B97\u673A\u4E2D\u901A\u8FC7\u8865\u7801\u8FDB\u884C\u8BA1\u7B97</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>  <span class="token comment">// \u8D1F\u6570\u7684\u8865\u7801 + \u6B63\u6570\u7684\u8865\u7801 = 0</span>

  <span class="token comment">// \u8D1F\u6570              \u6B63\u6570</span>
  <span class="token comment">// \u539F\u7801  1 001011    0 001011</span>
  <span class="token comment">// \u53CD\u7801  1 110100    1 110101</span>
  <span class="token comment">// \u8865\u7801  1 110101</span>

  <span class="token comment">// 4     +   (-4)  = 0</span>
  <span class="token comment">// 00100 +   10100 </span>
  <span class="token comment">// 00100 +   11011(\u53CD\u7801)</span>
  <span class="token comment">// 00100 +   11100(\u8865\u7801)</span>
\u590D\u5236\u4EE3\u7801
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="arraybuffer-\u6700\u57FA\u672C\u7684" tabindex="-1"><a class="header-anchor" href="#arraybuffer-\u6700\u57FA\u672C\u7684" aria-hidden="true">#</a> ArrayBuffer(\u6700\u57FA\u672C\u7684)</h2><ul><li>8\u4F4D == 1\u4E2A\u5B57\u8282,ArrayBuffer\u5B57\u8282\u6570\u7EC4(\u6BCF\u4E2A\u90FD\u662F8\u4F4D),\u4ED6\u91CC\u9762\u5B58\u653E\u7684\u5C31\u662F\u5B57\u8282</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 8\u4E2A\u5B57\u8282*8\u4E2A\u4F4D = 64\u4F4D</span>
<span class="token keyword">let</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
\u590D\u5236\u4EE3\u7801
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="typedarray-\u7C7B\u578B\u6570\u636E" tabindex="-1"><a class="header-anchor" href="#typedarray-\u7C7B\u578B\u6570\u636E" aria-hidden="true">#</a> TypedArray \u7C7B\u578B\u6570\u636E</h2><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 8\u4E2A\u5B57\u8282\u7684ArrayBuffer</span>
<span class="token keyword">const</span> int8Array <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Int8Array</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token comment">// 1\u4E2A\u6574\u6570\u5360\u636E8\u4E2A\u4F4D </span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>int8Array<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token comment">//  \u5143\u7D20\u7684\u957F\u5EA68,1\u4E2A\u5B57\u8282\u5360\u636E8\u4E2A\u4F4D</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>int8Array<span class="token punctuation">.</span>buffer <span class="token operator">===</span> buffer<span class="token punctuation">)</span><span class="token comment">// true</span>

<span class="token keyword">const</span> int16Array <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Int16Array</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token comment">// 1\u4E2A\u6574\u6570\u5360\u636E16\u4E2A\u4F4D </span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>int16Array<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token comment">// \u5143\u7D20\u7684\u957F\u5EA64,1\u4E2A\u5B57\u8282\u5360\u636E16\u4E2A\u4F4D</span>
\u590D\u5236\u4EE3\u7801
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="dataview-\u5BF9\u8C61" tabindex="-1"><a class="header-anchor" href="#dataview-\u5BF9\u8C61" aria-hidden="true">#</a> DataView \u5BF9\u8C61</h2><ul><li>DataView \u89C6\u56FE\u662F\u4E00\u4E2A\u53EF\u4EE5\u4ECE\u4E8C\u8FDB\u5236ArrayBuffer\u5BF9\u8C61\u4E2D\u8BFB\u5199\u591A\u79CD\u6570\u503C\u7C7B\u578B\u7684\u5E95\u5C42\u63A5\u53E3</li><li>setInt8()\u4ECEDataView\u8D77\u59CB\u4F4D\u7F6E\u4EE5byte\u4E3A\u8BA1\u6570\u7684\u6307\u5B9A\u504F\u79FB\u91CF(byteOffset)\u5904\u50A8\u5B58\u4E00\u4E2A8-bit\u6570(\u4E00\u4E2A\u5B57\u8282)</li><li>getInt8()\u4ECEDataView\u8D77\u59CB\u4F4D\u7F6E\u4EE5byte\u4E3A\u8BA1\u6570\u7684\u6307\u5B9A\u504F\u79FB\u91CF(byteOffset)\u5904\u83B7\u53D6\u4E00\u4E2A8-bit\u6570(\u4E00\u4E2A\u5B57\u8282)</li><li>DataView\u548CTypeArray \u5185\u90E8\u90FD\u5F15\u7528\u4E86buffer,buffer\u4E0D\u80FD\u76F4\u63A5\u7528</li></ul><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e0204a977d8b44369d3f29c6d649c49e~tplv-k3u1fbpfcp-watermark.awebp" alt="DataView.jpg"></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// \u521B\u5EFA\u4E00\u4E2A8\u5B57\u8282\u7684 arrayBuffer</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span>byteLength<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//8\u4E2A\u5B57\u8282</span>
<span class="token keyword">const</span> view1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataView</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// \u7B2C\u4E00\u4E2A \u6574\u6570\u4E3A8\u4E2A\u5B57\u8282 \u503C\u4E3A1</span>
view1<span class="token punctuation">.</span><span class="token function">setInt8</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0 \u662F\u5F00\u59CB\u4F4D\u5B50 \u5B58\u51651</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>view1<span class="token punctuation">.</span><span class="token function">getInt8</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1</span>
<span class="token comment">// \u7B2C\u4E8C\u4E2A \u6574\u6570\u4E3A8\u4E2A\u5B57\u8282 \u503C\u4E3A1</span>
view1<span class="token punctuation">.</span><span class="token function">setInt8</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1 \u662F\u5F00\u59CB\u4F4D\u5B50 \u8DF3\u8FC78\u4E2A\u5B57\u8282 \u5B58\u51652</span>
<span class="token comment">// \u8BFB\u53D6\u7B2C\u4E8C\u4E2A\u5B57\u8282\u7684\u65F6\u5019  \u4E8C\u8FDB\u5236\u4F4D 0000 0010 \u4E3A2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>view1<span class="token punctuation">.</span><span class="token function">getInt8</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//2</span>

<span class="token comment">// \u8BFB\u53D6 16\u4F4D\u7684\u65F6\u5019 \u628A\u56FE\u4E0A\u9762\u76842\u4E2A\u4E8C\u8FDB\u5236\u62FC\u63A5\u4E0A\u53BB  \u5F97\u5230\u7684\u662F258</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>view1<span class="token punctuation">.</span><span class="token function">getInt16</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//258</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>view1<span class="token punctuation">.</span>buffer <span class="token operator">===</span> buffer<span class="token punctuation">)</span>
\u590D\u5236\u4EE3\u7801
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h2 id="\u5B57\u7B26-base64-\u8F6C\u5316" tabindex="-1"><a class="header-anchor" href="#\u5B57\u7B26-base64-\u8F6C\u5316" aria-hidden="true">#</a> \u5B57\u7B26&amp;&amp;base64 \u8F6C\u5316</h2><ul><li>window.btoa &amp;&amp; window.atob <ul><li>\u5B83\u5B58\u5728window\u4E0A</li><li>btoa \u9614\u4EE5\u5C06 \u5B57\u7B26\u4E32\u8F6C\u5316\u6210\u4E00\u4E2Abase64</li><li>atob \u5C06base64 \u8F6C\u5316\u6210 \u5B57\u7B26\u4E32</li></ul></li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> rs <span class="token operator">=</span>  <span class="token function">btoa</span><span class="token punctuation">(</span><span class="token string">&#39;xxx&#39;</span><span class="token punctuation">)</span>
<span class="token comment">// rs \u662F\u4E00\u4E2Abase64\u5B57\u7B26\u4E32</span>

<span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token function">atob</span><span class="token punctuation">(</span>rs<span class="token punctuation">)</span>
<span class="token comment">// atob \u628Abase64\u8F6C\u6210\u5B57\u7B26\u4E32 s===&#39;xxx&#39;</span>
\u590D\u5236\u4EE3\u7801
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="filereader-blob-file-\u8F6C\u5316" tabindex="-1"><a class="header-anchor" href="#filereader-blob-file-\u8F6C\u5316" aria-hidden="true">#</a> FileReader &amp;&amp; Blob/File \u8F6C\u5316</h2><ul><li>FileReader\u51FD\u6570, \u8BFB\u53D6Blob,\u4ED6\u67093\u4E2A\u8BFB\u53D6\u7684\u65B9\u5F0F,\u5206\u522B\u751F\u6210ArrayBuffer,base64\u5B57\u7B26\u4E32,\u6587\u672C</li><li>readAsArrayBuffer\u751F\u6210\u7684\u662F ArrayBuffer</li><li>readAsDataURL\u751F\u6210\u7684\u662F base64\u5B57\u7B26\u4E32</li><li>readAsText\u751F\u6210\u7684\u662F \u751F\u6210\u7684\u662F\u4E00\u4E2A\u6587\u672C</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">readBlob</span><span class="token punctuation">(</span><span class="token parameter">blob<span class="token punctuation">,</span>type</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    reader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">switch</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">&#39;ArrayBuffer&#39;</span><span class="token operator">:</span>
      <span class="token comment">// readAsArrayBuffer\u751F\u6210\u7684\u662F ArrayBuffer</span>
        reader<span class="token punctuation">.</span><span class="token function">readAsArrayBuffer</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token string">&#39;DataURL&#39;</span><span class="token operator">:</span>
      <span class="token comment">// \u4E8C\u8FDB\u5236\u6570\u636E\u8F6C\u6362\u6210\u53EF\u8BFB\u7684\u5B57\u7B26\u4E32 base64\u5B57\u7B26\u4E32</span>
        reader<span class="token punctuation">.</span><span class="token function">readAsDataURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token string">&#39;Text&#39;</span><span class="token operator">:</span>
      <span class="token comment">// \u751F\u6210\u7684\u662F\u4E00\u4E2A\u6587\u672C</span>
        reader<span class="token punctuation">.</span><span class="token function">readAsText</span><span class="token punctuation">(</span>blob<span class="token punctuation">,</span><span class="token string">&#39;utf-8&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">default</span><span class="token operator">:</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">readBlob</span><span class="token punctuation">(</span>blob<span class="token punctuation">,</span><span class="token string">&#39;ArrayBuffer&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">rs</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;ArrayBuffer&#39;</span><span class="token punctuation">,</span>rs<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">readBlob</span><span class="token punctuation">(</span>blob<span class="token punctuation">,</span><span class="token string">&#39;DataURL&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">rs</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;DataURL&#39;</span><span class="token punctuation">,</span>rs<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">readBlob</span><span class="token punctuation">(</span>blob<span class="token punctuation">,</span><span class="token string">&#39;Text&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">rs</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Text&#39;</span><span class="token punctuation">,</span>rs<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
\u590D\u5236\u4EE3\u7801
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h2 id="file-blob-\u8F6C\u6362" tabindex="-1"><a class="header-anchor" href="#file-blob-\u8F6C\u6362" aria-hidden="true">#</a> File &amp;&amp; Blob \u8F6C\u6362</h2><h3 id="blob-file" tabindex="-1"><a class="header-anchor" href="#blob-file" aria-hidden="true">#</a> Blob=&gt;File</h3><ul><li>\u7528\u6CD5</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">[</span>blob<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;foo.png&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;image/png&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
\u590D\u5236\u4EE3\u7801
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="blob-file-1" tabindex="-1"><a class="header-anchor" href="#blob-file-1" aria-hidden="true">#</a> Blob=&gt;File</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>file<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">&#39;image/png&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
\u590D\u5236\u4EE3\u7801
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="blob" tabindex="-1"><a class="header-anchor" href="#blob" aria-hidden="true">#</a> Blob</h2><ul><li>\u6587\u4EF6\u4F20\u8F93,\u4E0A\u4F20\u4E0B\u8F7D,\u90FD\u662F Blob\u683C\u5F0F</li><li>Blob\u51FD\u6570</li><li>\u6784\u9020\u51FD\u6570 var aBlob = new Blob( array, options ); <ul><li>array \u662F\u4E00\u4E2A\u7531ArrayBuffer, ArrayBufferView, Blob, DOMString(js string) \u7B49\u5BF9\u8C61\u6784\u6210\u7684 Array \uFF0C\u6216\u8005\u5176\u4ED6\u7C7B\u4F3C\u5BF9\u8C61\u7684\u6DF7\u5408\u4F53\uFF0C\u5B83\u5C06\u4F1A\u88AB\u653E\u8FDB Blob\u3002DOMStrings\u4F1A\u88AB\u7F16\u7801\u4E3AUTF-8\u3002</li><li>options \u662F\u4E00\u4E2A\u53EF\u9009\u7684BlobPropertyBag\u5B57\u5178</li><li>type \u9ED8\u8BA4\u503C\u4E3A &quot;&quot;,\u5B83\u4EE3\u8868\u4E86\u5C06\u4F1A\u88AB\u653E\u5165\u5230blob\u4E2D\u7684\u6570\u7EC4\u5185\u5BB9\u7684MIME\u7C7B\u578B</li></ul></li></ul><h2 id="ojecturl" tabindex="-1"><a class="header-anchor" href="#ojecturl" aria-hidden="true">#</a> OjectURL</h2><ul><li>URL.createObjectURL <ul><li>\u53EF\u4EE5\u83B7\u53D6\u5F53\u524D\u6587\u4EF6\u7684\u4E00\u4E2A\u5185\u5B58URL</li><li>\u5229\u7528 DOMString \u751F\u6210\u4E00\u4E2A blob \u6587\u4EF6\u4E0B\u8F7D\u6210json</li></ul></li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// DOMString</span>
<span class="token keyword">function</span> <span class="token function">download</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token string">&#39;xxxxx&#39;</span>
    <span class="token keyword">let</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>data<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">&#39;application/json&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> a <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;a&#39;</span><span class="token punctuation">)</span>
      a<span class="token punctuation">.</span>download <span class="token operator">=</span> <span class="token string">&#39;user.json&#39;</span><span class="token comment">//\u4E0B\u8F7D\u540D</span>
      a<span class="token punctuation">.</span>rel <span class="token operator">=</span> <span class="token string">&#39;noopener&#39;</span>
      a<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span>
      a<span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MouseEvent</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">revokeObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u9500\u6BC1objectURL \u4E5F\u4F1A\u9500\u6BC1Blob</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>blob<span class="token punctuation">,</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
\u590D\u5236\u4EE3\u7801
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ul><li>\u5229\u7528\u4E0A\u4F20\u56FE\u7247\u4E0B\u8F7D</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;file&quot;</span> onchange<span class="token operator">=</span><span class="token string">&quot;handleChange(event)&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>button onclick<span class="token operator">=</span><span class="token string">&quot;download()&quot;</span><span class="token operator">&gt;</span>\u4E0B\u8F7D<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
  <span class="token keyword">function</span> <span class="token function">download</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">let</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
  <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>data<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>arr<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">&#39;image/png&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> a <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;a&#39;</span><span class="token punctuation">)</span>
    a<span class="token punctuation">.</span>download <span class="token operator">=</span> <span class="token string">&#39;user.png&#39;</span><span class="token comment">//\u4E0B\u8F7D\u540D</span>
    a<span class="token punctuation">.</span>rel <span class="token operator">=</span> <span class="token string">&#39;noopener&#39;</span>
    <span class="token comment">// a.href = blob;</span>
    a<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span>
    a<span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MouseEvent</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">revokeObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u9500\u6BC1objectURL \u4E5F\u4F1A\u9500\u6BC1Blob</span>
<span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">handleChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> file <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    file <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> fileReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      fileReader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token comment">// atob \u662F\u4E00\u4E2A\u5168\u5C40\u65B9\u6CD5</span>
        <span class="token comment">// base64 \u5FC5\u987B\u8981\u8F6C\u6362\u6210 \u5B57\u7B26\u6570 </span>
        <span class="token keyword">let</span> bytes <span class="token operator">=</span> <span class="token function">atob</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;,&#39;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token function">download</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      fileReader<span class="token punctuation">.</span><span class="token function">readAsDataURL</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
\u590D\u5236\u4EE3\u7801
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h2 id="dataurl" tabindex="-1"><a class="header-anchor" href="#dataurl" aria-hidden="true">#</a> DataURL</h2><ul><li>base64 \u5B57\u7B26\u4E32</li></ul><h3 id="blob\u751F\u6210dataurl" tabindex="-1"><a class="header-anchor" href="#blob\u751F\u6210dataurl" aria-hidden="true">#</a> Blob\u751F\u6210DataURL</h3><ul><li>DataURL\u9614\u4EE5\u76F4\u63A5\u7ED9img.src \u4F7F\u7528</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">readBlob</span><span class="token punctuation">(</span><span class="token parameter">blob<span class="token punctuation">,</span>type</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    reader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">switch</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">&#39;ArrayBuffer&#39;</span><span class="token operator">:</span>
      <span class="token comment">// readAsArrayBuffer\u751F\u6210\u7684\u662F ArrayBuffer</span>
        reader<span class="token punctuation">.</span><span class="token function">readAsArrayBuffer</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token string">&#39;DataURL&#39;</span><span class="token operator">:</span>
      <span class="token comment">// \u4E8C\u8FDB\u5236\u6570\u636E\u8F6C\u6362\u6210\u53EF\u8BFB\u7684\u5B57\u7B26\u4E32 base64\u5B57\u7B26\u4E32</span>
        reader<span class="token punctuation">.</span><span class="token function">readAsDataURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token string">&#39;Text&#39;</span><span class="token operator">:</span>
      <span class="token comment">// \u751F\u6210\u7684\u662F\u4E00\u4E2A\u6587\u672C</span>
        reader<span class="token punctuation">.</span><span class="token function">readAsText</span><span class="token punctuation">(</span>blob<span class="token punctuation">,</span><span class="token string">&#39;utf-8&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">default</span><span class="token operator">:</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">readBlob</span><span class="token punctuation">(</span>blob<span class="token punctuation">,</span><span class="token string">&#39;ArrayBuffer&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">rs</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;ArrayBuffer&#39;</span><span class="token punctuation">,</span>rs<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">readBlob</span><span class="token punctuation">(</span>blob<span class="token punctuation">,</span><span class="token string">&#39;DataURL&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">rs</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;DataURL&#39;</span><span class="token punctuation">,</span>rs<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">readBlob</span><span class="token punctuation">(</span>blob<span class="token punctuation">,</span><span class="token string">&#39;Text&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">rs</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Text&#39;</span><span class="token punctuation">,</span>rs<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
\u590D\u5236\u4EE3\u7801
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h3 id="input-\u4E0A\u4F20\u7684\u6587\u4EF6-\u56FE\u7247-xlsx\u7B49-\u5982\u4F55\u8F6C\u6362\u6210-array" tabindex="-1"><a class="header-anchor" href="#input-\u4E0A\u4F20\u7684\u6587\u4EF6-\u56FE\u7247-xlsx\u7B49-\u5982\u4F55\u8F6C\u6362\u6210-array" aria-hidden="true">#</a> input \u4E0A\u4F20\u7684\u6587\u4EF6(\u56FE\u7247,xlsx\u7B49)\u5982\u4F55\u8F6C\u6362\u6210 array</h3><ul><li>FileReader\u51FD\u6570,\u4ED6\u67093\u4E2A\u8BFB\u53D6\u7684\u65B9\u5F0F,\u5206\u522B\u751F\u6210<code>ArrayBuffer</code>,<code>base64\u5B57\u7B26\u4E32</code>,<code>\u6587\u672C</code></li><li>input \u4E0A\u4F20\u6587\u4EF6\u5C31\u662F\u4E00\u4E2A Blob</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">readBlob</span><span class="token punctuation">(</span><span class="token parameter">blob<span class="token punctuation">,</span>type</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    reader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">switch</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">&#39;ArrayBuffer&#39;</span><span class="token operator">:</span>
      <span class="token comment">// readAsArrayBuffer\u751F\u6210\u7684\u662F ArrayBuffer</span>
        reader<span class="token punctuation">.</span><span class="token function">readAsArrayBuffer</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token string">&#39;DataURL&#39;</span><span class="token operator">:</span>
      <span class="token comment">// \u4E8C\u8FDB\u5236\u6570\u636E\u8F6C\u6362\u6210\u53EF\u8BFB\u7684\u5B57\u7B26\u4E32 base64\u5B57\u7B26\u4E32</span>
        reader<span class="token punctuation">.</span><span class="token function">readAsDataURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token string">&#39;Text&#39;</span><span class="token operator">:</span>
      <span class="token comment">// \u751F\u6210\u7684\u662F\u4E00\u4E2A\u6587\u672C</span>
        reader<span class="token punctuation">.</span><span class="token function">readAsText</span><span class="token punctuation">(</span>blob<span class="token punctuation">,</span><span class="token string">&#39;utf-8&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">default</span><span class="token operator">:</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">readBlob</span><span class="token punctuation">(</span>blob<span class="token punctuation">,</span><span class="token string">&#39;ArrayBuffer&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">rs</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;ArrayBuffer&#39;</span><span class="token punctuation">,</span>rs<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">readBlob</span><span class="token punctuation">(</span>blob<span class="token punctuation">,</span><span class="token string">&#39;DataURL&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">rs</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;DataURL&#39;</span><span class="token punctuation">,</span>rs<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">readBlob</span><span class="token punctuation">(</span>blob<span class="token punctuation">,</span><span class="token string">&#39;Text&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">rs</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Text&#39;</span><span class="token punctuation">,</span>rs<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
\u590D\u5236\u4EE3\u7801
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><ul><li>basr64 =&gt; ArrayBuffer =&gt; blob,\u4E0B\u8F7D\u56FE\u7247</li></ul><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">onchange</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">handleChange</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">download</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>\u4E0B\u8F7D<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>


  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">function</span> <span class="token function">download</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
    <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>data<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">let</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>arr<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">&#39;image/png&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> a <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;a&#39;</span><span class="token punctuation">)</span>
      a<span class="token punctuation">.</span>download <span class="token operator">=</span> <span class="token string">&#39;user.png&#39;</span><span class="token comment">//\u4E0B\u8F7D\u540D</span>
      a<span class="token punctuation">.</span>rel <span class="token operator">=</span> <span class="token string">&#39;noopener&#39;</span>
      <span class="token comment">// a.href = blob;</span>
      a<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span>
      a<span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MouseEvent</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">revokeObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u9500\u6BC1objectURL \u4E5F\u4F1A\u9500\u6BC1Blob</span>
  <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">handleChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">let</span> file <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      file <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> fileReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        fileReader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
          <span class="token comment">// atob \u662F\u4E00\u4E2A\u5168\u5C40\u65B9\u6CD5</span>
          <span class="token comment">// base64 \u5FC5\u987B\u8981\u8F6C\u6362\u6210 \u5B57\u7B26\u6570 </span>
          <span class="token keyword">let</span> bytes <span class="token operator">=</span> <span class="token function">atob</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;,&#39;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
          <span class="token function">download</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        fileReader<span class="token punctuation">.</span><span class="token function">readAsDataURL</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
\u590D\u5236\u4EE3\u7801
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h3 id="blob-\u8F6C\u6362-base64\u6216\u8005image" tabindex="-1"><a class="header-anchor" href="#blob-\u8F6C\u6362-base64\u6216\u8005image" aria-hidden="true">#</a> Blob \u8F6C\u6362 base64\u6216\u8005image</h3><ul><li>URL.createObjectURL</li><li>reader.readAsDataURL</li></ul><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">onchange</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">handleChange</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span><span class="token punctuation">&#39;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>img<span class="token punctuation">&#39;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">function</span> <span class="token function">handleChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> file <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    file <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>
    img<span class="token punctuation">.</span>src<span class="token operator">=</span>  url
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> file <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    file <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> fileReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      fileReader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        img<span class="token punctuation">.</span>src <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>src<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      fileReader<span class="token punctuation">.</span><span class="token function">readAsDataURL</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
\u590D\u5236\u4EE3\u7801
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h2 id="canvas" tabindex="-1"><a class="header-anchor" href="#canvas" aria-hidden="true">#</a> Canvas</h2><h3 id="imagedata-canvas-\u5E94\u7528" tabindex="-1"><a class="header-anchor" href="#imagedata-canvas-\u5E94\u7528" aria-hidden="true">#</a> imageData =&gt; canvas \u5E94\u7528</h3><h3 id="canvas-imagedata-\u5E94\u7528" tabindex="-1"><a class="header-anchor" href="#canvas-imagedata-\u5E94\u7528" aria-hidden="true">#</a> canvas =&gt; imageData \u5E94\u7528</h3><ul><li>\u56FE\u7247\u622A\u56FE\u4E0A\u4F20 \u5BF9\u7167\u4E0A\u56FE\u7684api\u8FDB\u884C</li></ul><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
    <span class="token selector">body</span><span class="token punctuation">{</span>
      <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token selector">.div1 img</span><span class="token punctuation">{</span>
      <span class="token property">border</span><span class="token punctuation">:</span> 2px dashed green<span class="token punctuation">;</span>
      <span class="token property">width</span><span class="token punctuation">:</span> 500px<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token selector">.div1</span><span class="token punctuation">{</span>
      <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
      <span class="token property">width</span><span class="token punctuation">:</span> 500px<span class="token punctuation">;</span>
      <span class="token property">flex-wrap</span><span class="token punctuation">:</span> wrap<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>div1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">accept</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>image/*<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">onchange</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">handleChange</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>img<span class="token punctuation">&#39;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
      <span class="token selector">.div2</span><span class="token punctuation">{</span>
        <span class="token property">margin-left</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>
        <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">#can</span><span class="token punctuation">{</span>
        <span class="token property">border</span><span class="token punctuation">:</span> 2px dashed blue<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.divCenter</span><span class="token punctuation">{</span>
        <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
        <span class="token property">width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
        <span class="token property">height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
        <span class="token property">background</span><span class="token punctuation">:</span> yellow<span class="token punctuation">;</span>
        <span class="token property">opacity</span><span class="token punctuation">:</span> 0.3<span class="token punctuation">;</span>
        <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
        <span class="token property">right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
        <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
        <span class="token property">bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
        <span class="token property">margin</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>div2<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">onmousedown</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">handleMouseDown</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span> <span class="token special-attr"><span class="token attr-name">onmousemove</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">handleMouseMove</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span> <span class="token special-attr"><span class="token attr-name">onmouseup</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">handleMouseUp</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span>
        <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>can<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>300px<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>300px<span class="token punctuation">&quot;</span></span>
      <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>divCenter<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn-group<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">bigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>\u53D8\u5927<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">smaller</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>\u53D8\u5C0F<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">confirm</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>\u526A\u8F91<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>div3<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100px<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>img1<span class="token punctuation">&#39;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>\u4E0A\u4F20<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      <span class="token keyword">let</span> state <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">timer</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token comment">// \u653E\u5927\u500D\u6570</span>
        <span class="token literal-property property">startX</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token comment">// \u9F20\u6807\u6309\u4E0B\u7684\u5F00\u59CBX\u5750\u6807</span>
        <span class="token literal-property property">startY</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">startDrag</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token comment">//\u5F00\u59CB\u62D6\u52A8</span>
        <span class="token literal-property property">lastX</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token comment">// \u4E0A\u4E00\u6B21\u9F20\u6807\u62AC\u8D77\u7684\u4F4D\u5B50</span>
        <span class="token literal-property property">lastY</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">avatarDataURL</span><span class="token operator">:</span><span class="token string">&#39;&#39;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">let</span> img <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;#img&#39;</span><span class="token punctuation">)</span>
      <span class="token keyword">let</span> img1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;#img1&#39;</span><span class="token punctuation">)</span>
      <span class="token keyword">let</span> can <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;canvas&#39;</span><span class="token punctuation">)</span>
      <span class="token function-variable function">upload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token comment">// base64\u683C\u5F0F:\u7C7B\u578B+,+\u6570\u636E </span>
        <span class="token comment">// atob \u8F6C\u6362\u7684\u65F6\u5019\u53EA\u80FD\u5BF9base64\u7684\u6570\u636E\u8FDB\u884C\u5904\u7406</span>
        <span class="token keyword">let</span> bytes <span class="token operator">=</span> <span class="token function">atob</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>avatarDataURL<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;,&#39;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

        <span class="token keyword">let</span> arrayBuffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
        <span class="token keyword">let</span> uint8Array <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>arrayBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>bytes<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          uint8Array<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> bytes<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">let</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>uint8Array<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">&#39;image/png&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">ss</span><span class="token operator">:</span><span class="token string">&#39;xxx&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span>
        <span class="token keyword">let</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&#39;avatar&#39;</span><span class="token punctuation">,</span>blob<span class="token punctuation">)</span>
        xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&#39;POST&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;http://localhost:4000/upload&#39;</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>formData<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      
      <span class="token function-variable function">bigger</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        state<span class="token punctuation">.</span>timer <span class="token operator">+=</span><span class="token number">0.1</span> 
        <span class="token function">drawImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token function-variable function">smaller</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        state<span class="token punctuation">.</span>timer <span class="token operator">-=</span><span class="token number">0.1</span> 
        <span class="token function">drawImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token function-variable function">confirm</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> ctx <span class="token operator">=</span> can<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;2d&#39;</span><span class="token punctuation">)</span>
        <span class="token comment">// \u590D\u5236\u753B\u5E03\u4E0A\u6307\u5B9A\u77E9\u5F62\u7684\u50CF\u7D20\u6570\u636E</span>
        <span class="token comment">// canvas =&gt; imageData</span>
        <span class="token keyword">const</span> imageData <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getImageData</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span>
        <span class="token keyword">let</span> avatar <span class="token operator">=</span>  document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;canvas&#39;</span><span class="token punctuation">)</span>
        avatar<span class="token punctuation">.</span>width <span class="token operator">=</span><span class="token number">100</span>
        avatar<span class="token punctuation">.</span>height<span class="token operator">=</span> <span class="token number">100</span>
        <span class="token keyword">let</span> avatarCtx <span class="token operator">=</span> avatar<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;2d&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u7136\u540E\u901A\u8FC7 putImageData() \u5C06\u56FE\u50CF\u6570\u636E\u653E\u56DE\u753B\u5E03</span>
        <span class="token comment">// imageData =&gt; canvas</span>
        avatarCtx<span class="token punctuation">.</span><span class="token function">putImageData</span><span class="token punctuation">(</span>imageData<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token comment">// base64</span>
        <span class="token keyword">let</span> avatarDataURL <span class="token operator">=</span> avatar<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        state<span class="token punctuation">.</span>avatarDataURL <span class="token operator">=</span> avatarDataURL
        img1<span class="token punctuation">.</span>src <span class="token operator">=</span> avatarDataURL
      <span class="token punctuation">}</span>
      <span class="token function-variable function">handleMouseDown</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        state<span class="token punctuation">.</span>startX <span class="token operator">=</span> event<span class="token punctuation">.</span>clientX
        state<span class="token punctuation">.</span>startY <span class="token operator">=</span> event<span class="token punctuation">.</span>clientY
        state<span class="token punctuation">.</span>startDrag <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
      <span class="token function-variable function">handleMouseMove</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token comment">// X\u4EFF\u6548\u79FB\u52A8\u7684\u91CF Y\u65B9\u5411\u79FB\u52A8\u7684\u91CF</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>startDrag<span class="token punctuation">)</span>
        <span class="token function">drawImage</span><span class="token punctuation">(</span>
          event<span class="token punctuation">.</span>clientX<span class="token operator">-</span>state<span class="token punctuation">.</span>startX<span class="token operator">+</span>state<span class="token punctuation">.</span>lastX<span class="token punctuation">,</span>
          event<span class="token punctuation">.</span>clientY<span class="token operator">-</span>state<span class="token punctuation">.</span>startY<span class="token operator">+</span>state<span class="token punctuation">.</span>lastY  <span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token function-variable function">handleMouseUp</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        state<span class="token punctuation">.</span>startDrag <span class="token operator">=</span> <span class="token boolean">false</span>
        state<span class="token punctuation">.</span>lastX <span class="token operator">=</span> event<span class="token punctuation">.</span>clientX <span class="token operator">-</span> state<span class="token punctuation">.</span>startX <span class="token operator">+</span>state<span class="token punctuation">.</span>lastX
        state<span class="token punctuation">.</span>lastY <span class="token operator">=</span> event<span class="token punctuation">.</span>clientY <span class="token operator">-</span> state<span class="token punctuation">.</span>startY <span class="token operator">+</span>state<span class="token punctuation">.</span>lastY
      <span class="token punctuation">}</span>
      <span class="token function-variable function">drawImage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">left<span class="token operator">=</span>state<span class="token punctuation">.</span>lastX<span class="token punctuation">,</span>top<span class="token operator">=</span>state<span class="token punctuation">.</span>lastY</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> ctx <span class="token operator">=</span> can<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;2d&#39;</span><span class="token punctuation">)</span>
        ctx<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>can<span class="token punctuation">.</span>width<span class="token punctuation">,</span>can<span class="token punctuation">.</span>height<span class="token punctuation">)</span>
        <span class="token keyword">let</span> imageWidth <span class="token operator">=</span> img<span class="token punctuation">.</span>width
        <span class="token keyword">let</span> imageHeight <span class="token operator">=</span> img<span class="token punctuation">.</span>height
        <span class="token keyword">if</span><span class="token punctuation">(</span>imageWidth<span class="token operator">&gt;</span>imageHeight<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// \u5982\u679C\u5BBD\u5EA6\u6BD4\u9AD8\u5EA6\u8FBE \u56FE\u7247\u7684\u5BBD\u5EA6\u8C03\u6574\u4E3Acanvas\u5BBD\u5EA6</span>
          <span class="token keyword">let</span> scale <span class="token operator">=</span> can<span class="token punctuation">.</span>width<span class="token operator">/</span>imageWidth
          imageWidth <span class="token operator">=</span> can<span class="token punctuation">.</span>width<span class="token operator">*</span>state<span class="token punctuation">.</span>timer
          imageHeight <span class="token operator">=</span> can<span class="token punctuation">.</span>height<span class="token operator">*</span>scale<span class="token operator">*</span>state<span class="token punctuation">.</span>timer
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
          <span class="token keyword">let</span> scale <span class="token operator">=</span> can<span class="token punctuation">.</span>height<span class="token operator">/</span>imageHeight
          imageHeight <span class="token operator">=</span> can<span class="token punctuation">.</span>height<span class="token operator">*</span>state<span class="token punctuation">.</span>timer
          imageWidth <span class="token operator">=</span> can<span class="token punctuation">.</span>width<span class="token operator">*</span>scale<span class="token operator">*</span>state<span class="token punctuation">.</span>timer
        <span class="token punctuation">}</span>
        <span class="token comment">// \u753B\u56FE\u7247</span>
        ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span><span class="token punctuation">(</span>can<span class="token punctuation">.</span>width<span class="token operator">-</span>imageWidth<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token operator">+</span>left<span class="token punctuation">,</span><span class="token punctuation">(</span>can<span class="token punctuation">.</span>height<span class="token operator">-</span>imageHeight<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token operator">+</span>top<span class="token punctuation">,</span>imageWidth<span class="token punctuation">,</span>imageHeight<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">function</span> <span class="token function">handleChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> file <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> fileReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        fileReader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
          img<span class="token punctuation">.</span>src <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result
          <span class="token comment">// \u56FE\u7247\u52A0\u8F7D\u6210\u529F\u4E4B\u540E \u6267\u884C\u56DE\u8C03 \u7ED8\u5236canvas</span>
          img<span class="token punctuation">.</span><span class="token function-variable function">onload</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token function">drawImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        fileReader<span class="token punctuation">.</span><span class="token function">readAsDataURL</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
\u590D\u5236\u4EE3\u7801
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br></div></div><h2 id="\u540E\u53F0" tabindex="-1"><a class="header-anchor" href="#\u540E\u53F0" aria-hidden="true">#</a> \u540E\u53F0</h2><ul><li>express</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u56FE\u7247\u4E0A\u4F20</span>
<span class="token keyword">let</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;express&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> multer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;multer&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> cors <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;cors&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// \u5904\u7406json\u683C\u5F0F\u7684\u8BF7\u6C42\u4F53</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// \u5904\u7406\u8868\u5355\u683C\u5F0F\u7684\u8BF7\u6C42\u4F53</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">extended</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// \u6587\u4EF6\u4E0A\u4F20 upload req.file\u83B7\u53D6\u6587\u4EF6\u7684\u6D41   dest req.file \u83B7\u53D6\u7684\u4FDD\u5B58\u8DEF\u5F84</span>
<span class="token keyword">let</span> upload <span class="token operator">=</span> <span class="token function">multer</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">upload</span><span class="token operator">:</span> <span class="token string">&#39;upload/&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&#39;/post&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> body <span class="token operator">=</span> req<span class="token punctuation">.</span>body
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&#39;/form&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> body <span class="token operator">=</span> req<span class="token punctuation">.</span>body
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// \u53EA\u6709\u4E00\u4E2A\u6587\u4EF6\u7C7B\u578B\u7684\u7528upload.single(&#39;avatar&#39;) \u5904\u7406</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&#39;/upload&#39;</span><span class="token punctuation">,</span> upload<span class="token punctuation">.</span><span class="token function">single</span><span class="token punctuation">(</span><span class="token string">&#39;avatar&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// req.file \u91CC\u9762\u5B58\u653E\u7684\u6587\u4EF6\u7C7B\u578B\u7684\u6570\u636E</span>
  <span class="token comment">// req.body \u91CC\u9762\u5B58\u653E\u7684\u666E\u901A\u7C7B\u578B\u7684\u6570\u636E</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>file<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> rs <span class="token operator">=</span> <span class="token string">&#39;.&#39;</span><span class="token operator">+</span>req<span class="token punctuation">.</span>file<span class="token punctuation">.</span>mimetype<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.+\\/(.+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;rs&#39;</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;req.file.originalname&#39;</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>file<span class="token punctuation">.</span>originalname<span class="token punctuation">)</span><span class="token punctuation">;</span>
    fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>req<span class="token punctuation">.</span>file<span class="token punctuation">.</span>fieldname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>rs<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>file<span class="token punctuation">.</span>buffer<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// xls</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&#39;/xls&#39;</span><span class="token punctuation">,</span> upload<span class="token punctuation">.</span><span class="token function">single</span><span class="token punctuation">(</span><span class="token string">&#39;avatar&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>file<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>req<span class="token punctuation">.</span>file<span class="token punctuation">.</span>fieldname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.xls</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>file<span class="token punctuation">.</span>buffer<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div>`,58);function t(e,o){return p}var u=s(a,[["render",t]]);export{u as default};
